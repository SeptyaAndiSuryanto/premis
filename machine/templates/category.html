{% extends 'base.html' %}
{% load i18n %}



{% block extra_head %}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
{% endblock  %}

{% block breadcrumbs %}
    <li class="breadcrumb-item">Machine</li>
    <li class="breadcrumb-item active">Category</li>
{% endblock %}

{% block sidebar %}
    {% include 'category_sidebar.html' %}
{% endblock sidebar %}

{% block body %}
<div class="card card-default color-palette-box">
    <div class="card-header">
        <h3 class="card-title"><i class="fa-solid fa-cubes-stacked"></i>&nbsp;</i>Machine Category</h3>
        <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
            </button>
          </div>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-6">
                <div class="card">
                    <div class="card-body p-0">
                    <table class="table table-sm">
                        <tbody>
                        <tr>
                            <td width="10%"><i class="fa-solid fa-circle-info"></i></td>
                            <td width="30%">Description</td>
                            <td>
                                {% if "/machine/category/" == request.path %}<cite title="Source Title">Top level machine category</cite>{% endif %}
                                {% if category %}
                                    {% if category.description %}
                                        {{ category.description }}
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td width="10%"><i class="fa-solid fa-network-wired"></td>
                            <td width="30%">Category Path</td>
                            <td>/</td>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-body p-0">
                    <table class="table table-sm">
                        <tbody>
                        <tr>
                            <td width="10%"><i class="fa-solid fa-network-wired"></i></td>
                            <td width="70%">Subcategories</td>
                            <td>{{ children.count }}</td>
                        </tr>
                        <tr>
                            <td width="10%"><i class="fa-brands fa-houzz"></td>
                            <td width="70%">Machine (Including subcategories)</td>
                            <td>{{ machine_count }}</td>
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card card-default color-palette-box">
    <div class="card-header">
        <h4 class="card-title"><i class="fa-solid fa-network-wired"></i>&nbsp;</i>Subcategories</h4>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-12">
                <div class="">
                    <div class="card-body p-0">
                        <div class='panel panel-hidden' id='panel-subcategories'>
                            {% comment %} <div class='panel-heading'>
                                <h4>{% trans "Subcategories" %}</h4>
                            </div> {% endcomment %}
                            <div class='panel-content'>
                                
                                {% comment %} <div id='subcategory-button-toolbar'>
                                    <div class='btn-group' role='group'>
                                        {% include "filter_list.html" with id="category" %}
                                    </div>
                                </div> {% endcomment %}
                        
                                <table class='table table-striped table-condensed' id='subcategory-table' data-toolbar='#subcategory-button-toolbar'></table>
                        
                            </div>
                        </div>
                        {{ item }}
                        <table id="subcategories-table" class="table table-bordered table-hover" style="width:100%">
                            <thead>
                            <tr>
                              <th>Name</th>
                              <th>Description</th>
                              <th>Path</th>
                            </tr>
                            </thead>
                          </table>
                        </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_javascript %}
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script language="javascript">
        $(document).ready(function () {
            var table = $('#subcategories-table').DataTable({
                processing: true,
                serverSide: true,
                ajax: "{% url 'machine-category-list' %}", 
                columns: [
                    {name: "name", data: "name"},
                    {name: "description", data: "description"},
                    {name: "pathstring", data: "pathstring"},
                ],
                search: {
                    return: true,
                },
            });
            //console.log(table);
            table.destroy();

            $('#subcategories-table tbody').on('click', 'tr', function () {
                var data = table.row( this ).data();
                console.log('1');
                console.log(data);

                var id = data.id;
                console.log('2');
                console.log(data);
            
                $.ajax({
                  "url": "{% url 'machine-category-list' %}?id=" + id,
                  "success": function(result) {
                    var table = $('#subcategories-table').DataTable({
                        processing: true,
                        serverSide: true,
                        ajax: "{% url 'machine-category-list' %}?id=" + id, 
                        columns: [
                            {name: "name", data: "name"},
                            {name: "description", data: "description"},
                            {name: "pathstring", data: "pathstring"},
                        ],
                        search: {
                            return: true,
                        },
                    });

                    //console.log(result.data);
                    //console.log(table);
                    //table.clear();
                    //table.rows.add(result.data);
                    //table.draw();
                  }
                });
              });
        });
    </script>
{% endblock %}